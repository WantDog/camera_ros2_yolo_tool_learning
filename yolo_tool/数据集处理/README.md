# 视频处理与目标检测工具

这是一个基于Python的视频处理和目标检测工具，主要用于数据集制作和标注。该工具提供了完整的工作流程，从视频录制到自动标注，特别适用于YOLO模型的数据集准备。

## 功能特性

- 📹 **视频录制**: 使用摄像头录制高质量视频
- 🖼️ **帧提取**: 从视频中按指定间隔提取帧
- 🔄 **帧重命名**: 批量重命名图像文件为连续编号
- 🗑️ **标签清理**: 删除没有对应图像的标签文件
- 🏷️ **自动标注**: 使用YOLO模型自动标注图像

## 项目结构

```
├── main.py              # 主程序文件
├── requirements.txt     # 依赖包列表
├── README.md           # 使用文档
├── datasets/           # 数据集目录
│   ├── classes.txt     # 类别定义文件
│   ├── images/         # 图像文件目录
│   └── labels/         # 标签文件目录
├── frames/             # 提取的帧存储目录
└── weights/            # 模型权重文件目录
```

## 环境要求

- Python 3.8+
- OpenCV 4.7.0+
- PyTorch (可选，用于YOLO模型)
- Ultralytics YOLO

*安装依赖*

```bash
pip install -r requirements.txt
```

## 使用指南

### 启动程序

```bash
python main.py
```

程序将打开一个图形界面，提供5个主要功能选项。

### 1. 视频录制

**功能**: 使用摄像头录制视频，支持实时开始/停止控制。

**操作步骤**:
1. 点击"Record Video"按钮
2. 摄像头窗口打开后，使用以下快捷键：
   - `A` 键：开始录制
   - `S` 键：停止录制并保存
   - `Q` 键：退出录制模式

**配置说明**:
- 默认分辨率：1280x720
- 默认帧率：20 FPS
- 视频格式：MP4 (MJPG编码)
- 保存路径：`/home/lzy/Desktop/数据集处理/videos` (可在代码中修改)

### 2. 帧提取

**功能**: 从录制的视频中按指定间隔提取帧作为训练图像。

**操作步骤**:
1. 点击"Extract Frames"按钮
2. 程序会显示可用的视频列表
3. 输入要处理的视频编号
4. 设置帧提取间隔（如：每10帧提取1帧）
5. 程序自动提取并保存帧到`frames/`目录

**提示**:
- 间隔越小，提取的帧越多
- 建议根据视频内容和数据集需求选择合适的间隔
- 提取的帧会自动编号，避免文件名冲突

### 3. 帧重命名

**功能**: 将frames目录中的所有图像文件重命名为连续的数字编号。

**操作步骤**:
1. 点击"Rename Frames"按钮
2. 输入起始编号（默认为1）
3. 程序自动重命名所有图像文件

**用途**:
- 整理数据集，确保文件名连续
- 合并多个批次的图像数据
- 为后续处理准备标准化的文件名

### 4. 删除未配对标签

**功能**: 清理没有对应图像文件的标签文件，保持数据集的一致性。

**操作步骤**:
1. 点击"Delete Unpaired Labels"按钮
2. 选择图像文件目录
3. 选择标签文件目录
4. 程序自动删除没有对应图像的标签文件

**应用场景**:
- 数据集清理和维护
- 删除图像后的标签同步
- 确保训练数据的完整性

### 5. 自动标注

**功能**: 使用预训练的YOLO模型对图像进行自动标注，生成YOLO格式的标签文件。

**操作步骤**:
1. 点击"Labeling"按钮
2. 选择包含图像的目录
3. 选择标签保存目录
4. 选择YOLO模型文件(.pt格式)
5. 程序自动处理所有图像并生成标签

**标注格式**:
- 输出格式：YOLO格式 (class_id x_center y_center width height)
- 坐标已归一化到[0,1]范围
- 置信度阈值：0.25

## 配置说明

### 摄像头设置
在`main.py`中可以修改以下参数：
```python
self.camera_id = 2  # 摄像头ID，根据系统调整
target_width = 1280  # 录制分辨率宽度
target_height = 720  # 录制分辨率高度
```

### 路径配置
```python
self.video_save_path = "/home/lzy/Desktop/数据集处理/videos"  # 视频保存路径
self.image_save_path = "frames/"  # 帧保存路径
```

### 检测参数
```python
conf=0.25  # 检测置信度阈值
```

## 数据集格式

### 类别定义
在`datasets/classes.txt`中定义检测类别：
```
volleyball
```

### 标签格式
YOLO格式标签文件示例：
```
0 0.5 0.5 0.3 0.4
```
格式说明：`class_id x_center y_center width height`

## 常见问题

### Q: 摄像头无法打开
A: 检查摄像头ID设置，尝试修改`camera_id`参数（通常为0、1、2等）

### Q: 视频无法播放或处理
A: 确保安装了完整的OpenCV和FFMPEG支持

### Q: 模型加载失败
A: 确认模型文件路径正确，且为Ultralytics YOLO格式(.pt文件)

### Q: 标注结果不准确
A: 调整置信度阈值或使用更适合的预训练模型
