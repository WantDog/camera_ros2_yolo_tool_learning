![image-20251018105407633](/home/lzy/.config/Typora/typora-user-images/image-20251018105407633.png)

# 声明：

本文档是用来留下我耗时将近半个月的moveit2的开发经历以及一些所谓的经验，希望后人看到后可以吸取经验，在我的肩膀上达到更高，也算是为at战队rc完成了一次技术探索和积累

# 正文：

首先是老生常谈的石一样的moveit2官方教程，这里给出地址（https://moveit.picknik.ai/main/index.html）



我的代码目录

```
src
├── hello_moveit
│   ├── hello_moveit_1.cpp
│   └── hello_moveit_2.cpp
└── mtc_tutorial
    └── mtc_node.cpp

```



这里我给出的建议是：如果你有足够耐心，那你就全部看完（其实谷歌翻译也是石，当你看不懂一些词的时候直接换回中文，自己一个一个单词吧）在配上我给你的实例代码，去一步一步学习，（那官方教程里面还有ros1的东西，也是没谁了），如果没有耐心，那我推荐你看完hello_moveit那个教程后就根据我给你src/mtc_tutorial去学习如何去给机械臂规划和抓取（仅针对六轴机械臂）。



当你把那个石一样的官方教程看完之后，如果战队没有紧急任务，我推荐你去使用我给你的文件夹里的urdf/ur_description模型，这些都是别人开源的机械臂，你可以从0开始自己在这个基础上去使用MoveIt Setup Assistant配置你自己的机械臂，如果战队有紧急任务要用自己的机械臂，请看下面sw导urdf的教程



## sw导urdf

1.找一位机械组的同学让他下载一个插件，这里给出插件地址（https://wiki.ros.org/action/fullsearch/sw_urdf_exporter?action=fullsearch&context=180&value=linkto:%22sw_urdf_exporter%22）（**特别建议：找个游戏本的，别tm用办公本，用办公本导urdf时一直卡死，很坐牢的！**）

2.下载后，恭喜你要成为机械组的一份子（dog），然后利用他的电脑去配置urdf文件，先选择好每个关节的基准轴，然后每个link的选择部件时，选择绕一个轴转的所有东西（也可以看是否有相对运动），每个link和joint都要选择revolute属性（**只有你选择这个属性的时候你稍后才能在rviz2里面拖动你的关节进度条以及随意拖动**），选择完后点击保存，然后就会弹出再次确定界面，在这里你要确定你每个关节的类型（看到底是不是revolute），还有Axis(轴),看一眼是不是绕着这个轴转的（例如：x:0 , y:0 ,z:1,就是绕z轴转，具体的可以问一下豆包同学），然后根据你的需求去限制关节角度，一般都是给-3.14和3.14,做到这一步接下来你该保存文件了，没错这里又有一个坑，你的命名不要用什么ur3（因为这个是moveit2里面有的机械臂，如果用它的话，当配置的时候他就会把你的机械臂认成这个ur3，非常的丁真啊！），就用my_arm之类的，然后发送到你的电脑上，让gpt给你改一下里面的ros1的东西



***(一定要定义基准轴和坐标系，如果出来的机械臂不能拖动，建议去给机械的商量一下，哪里不能拖动就去拆哪里的装配体，拆成两个！)***



## 放到ws_moveit2里面

然后你每次编译自己的机械臂包的时候，我推荐你使用选择包命令，这样可以直接编译选定的包，不必要每次把所有编译一遍

```
colcon build --packages-select 
```



编译完后可以启动里面自带的测试文件试试机械臂是否丁真

```
 例：ros2 launch arm_five display.launch.py
```



![image-20251018103920684](/home/lzy/.config/Typora/typora-user-images/image-20251018103920684.png)

然后进入ws_moveit终端source一下，接下来你就可以跟着配机械臂了

#### ***务必source一下，不然报错***

## 🚀 使用 MoveIt Setup Assistant 的步骤

#### 启动 Setup Assistant

```
ros2 run moveit_setup_assistant moveit_setup_assistant
```

------

##  **0.加载 URDF**

- 在界面左边点 **Create New MoveIt Configuration Package**。

- 选择你的 URDF 文件：

  - 如果你已经安装了 `ur3` 包，可以填 `package://ur3/urdf/ur3.urdf.xacro`

  - 否则就用绝对路径，比如：

    ```
    /home/lzy/ws_moveit/src/ur3/urdf/ur3.urdf.xacro
    ```

- 点击 **Load Files**，你会在右边看到机器人模型。

------

## **1. Self-Collisions (自碰撞)**

**具体操作步骤：**

1. 在左侧菜单点击"Self-Collisions"
2. 点击 **"Regenerate Default Collision Matrix"** 按钮
   - 系统会自动生成默认的碰撞矩阵
3. 如果需要自定义：
   - 勾选 **"Enable Self-Collision Checking"**
   - 点击 **"Edit Matrix"**
   - 在矩阵中取消勾选不需要检查碰撞的链接对
   - 点击 **"Save Matrix"**

## **2. Virtual Joints (虚拟关节)**

**具体操作步骤：**

1. 点击"Virtual Joints"
2. 点击 **"Add Virtual Joint"**
3. 填写参数：
   - **Name**: `virtual_joint` (或自定义名称)
   - **Child Link**: 选择机械臂基座链接，如 `base_link`
   - **Parent Frame**: `world` (或 `map`)
   - **Type**: 选择 `fixed` (固定) 或 `floating` (浮动)

## **3. Planning Groups (规划组)**

**创建机械臂规划组：**

1. 点击"Planning Groups"
2. 点击 **"Add Group"**
3. 配置参数：
   - **Group Name**: `arm_group` (或 `manipulator`)
   - **Kinematic Solver**: 选择 `KDLKinematicsPlugin`
   - **Resolution**: `0.005` (默认)
   - **Timeout**: `0.005` (默认)
4. 在"Group Contents"中：
   - 选择 **"Add Joints"**
   - 从左侧列表选择所有机械臂关节（如 `joint1`, `joint2`, ..., `joint6`）
   - 点击 **">"** 添加到右侧
5. 在"Kinematic Chain"中：
   - **Base Link**: 选择基座链接，如 `base_link`
   - **Tip Link**: 选择末端链接，如 `ee_link`
6. 点击 **"Save"**

**创建夹爪规划组（如有）：**

1. 再次点击 **"Add Group"**
2. **Group Name**: `gripper_group`
3. 选择夹爪相关关节

## **4. Robot Poses (机器人姿态)**

**具体操作步骤：**

1. 点击"Robot Poses"
2. 点击 **"Add Pose"**
3. 填写参数：
   - **Pose Name**: `home` (或 `ready`, `zero`)
4. 为每个关节设置角度值：
   - 手动输入或使用滑块调整
   - 例如：所有关节设为 0 度
5. 点击 **"Save"**

**添加更多预设姿态：**

- `pick_pose`: 抓取准备姿态
- `place_pose`: 放置姿态
- `stow_pose`: 收纳姿态

## **5. End Effectors (末端执行器)**

**具体操作步骤：**

1. 点击"End Effectors"
2. 点击 **"Add End Effector"**
3. 填写参数：
   - **End Effector Name**: `gripper` (或自定义)
   - **Parent Group**: 选择之前创建的规划组，如 `arm_group`
   - **Parent Link**: 选择末端链接，如 `ee_link`
   - **Group**: 选择夹爪规划组 `gripper_group` (如有)

## **6. Passive Joints (被动关节)**

**具体操作步骤（通常跳过）：**

1. 点击"Passive Joints"
2. 只有在有被动关节时才需要配置
3. 点击 **"Add Passive Joint"**
4. 选择被动关节名称

## **7. ros2_control URDF Models**

**具体操作步骤：**

1. 点击"ros2_control URDF Models"
2. 点击 **"Browse"** 选择你的URDF文件
3. 系统会自动解析URDF中的控制器配置
4. 确保URDF中包含类似内容：

xml

```
<ros2_control name="$(prefix)Gripper" type="system">
  <hardware>
    <plugin>mock_components/GenericSystem</plugin>
  </hardware>
  <joint name="gripper_joint">
    <command_interface name="position"/>
    <state_interface name="position"/>
  </joint>
</ros2_control>
```



## **8. ROS 2 Controllers**

**添加机械臂控制器：**

1. 点击"ROS 2 Controllers"
2. 点击 **"Add Controller"**
3. 配置参数：
   - **Controller Name**: `arm_controller`
   - **Type**: `position_controllers/JointTrajectoryController`
   - **Joints**: 选择所有机械臂关节
   - **Update Rate**: `100`

**添加夹爪控制器（如有）：**

1. 再次点击 **"Add Controller"**
2. **Controller Name**: `gripper_controller`
3. **Type**: `position_controllers/JointTrajectoryController`
4. **Joints**: 选择夹爪关节

## **9. MoveIt Controllers**

**具体操作步骤：**

1. 点击"MoveIt Controllers"
2. 点击 **"Add Controller"**
3. 配置参数：
   - **Controller Name**: `arm_controller`
   - **Type**: `FollowJointTrajectory`
   - **Joints**: 自动填充
4. 确保与ROS 2 Controllers中的名称一致

## **10. Perception (感知)**

**配置3D传感器：**

1. 点击"Perception"
2. 点击 **"Add Perception Device"**
3. 选择传感器类型：
   - **Camera**: 用于RGB-D相机
   - **LiDAR**: 用于激光雷达
4. 配置参数：
   - **Topic Name**: `/camera/depth/points` (示例)
   - **Sensor Frame**: `camera_link`
   - **Max Range**: `5.0`

## **11. Launch Files (启动文件)**

**具体操作步骤：**

1. 点击"Launch Files"
2. 系统会自动生成以下启动文件：
   - `demo.launch.py`: 演示启动文件
   - `move_group.launch.py`: MoveGroup核心功能
   - `moveit_rviz.launch.py`: RViz配置
3. 可以自定义修改参数

## **12. Author Information (作者信息)**

**填写信息：**

1. 点击"Author Information"
2. 填写：
   - **Author Name**: 你的名字
   - **Email**: 你的邮箱
   - **Maintainer**: 维护者信息
3. 点击 **"Save"**

## **13. Configuration Files (配置文件)**

**生成配置文件：**

1. 点击"Configuration Files"
2. 选择输出目录：
   - 通常为 `~/ws_moveit/src/your_robot_moveit_config`
3. 点击 **"Generate Package"**
4. 系统会生成所有配置文件并显示生成日志







生成后的文件

```
.
├── CMakeLists.txt
├── config
│   ├── arm_five.ros2_control.xacro
│   ├── arm_five.srdf
│   ├── arm_five.urdf.xacro
│   ├── initial_positions.yaml
│   ├── joint_limits.yaml
│   ├── kinematics.yaml
│   ├── moveit_controllers.yaml
│   ├── moveit.rviz
│   ├── pilz_cartesian_limits.yaml
│   └── ros2_controllers.yaml
├── launch
│   ├── demo.launch.py
│   ├── move_group.launch.py
│   ├── moveit_rviz.launch.py
│   ├── rsp.launch.py
│   ├── setup_assistant.launch.py
│   ├── spawn_controllers.launch.py
│   ├── static_virtual_joint_tfs.launch.py
│   └── warehouse_db.launch.py
└── package.xml
```

接下来把joint_limits.yaml和initial_positions.yaml里面的0和1全部改成1.0和0.0（如果不改启动会报错）



## 接下来阐述一下生成的launch文件都有什么用

1. **`demo.launch.py`**
   - **作用**：**“一键启动”演示文件**。这是你最开始测试和演示时最常用的文件。
   - **功能**：它会一次性启动所有必要的组件，包括：
     - 虚拟机器人状态发布器 (`rsp.launch.py`)
     - MoveIt 核心功能 (`move_group.launch.py`)
     - 在 RViz 中加载预配置好的界面 (`moveit_rviz.launch.py`)
     - （可能包括）仿真控制器
   - **使用场景**：快速启动一个完整的、可在 RViz 中进行交互式规划和仿真的环境。
2. **`move_group.launch.py`**
   - **作用**：启动 **MoveIt 的核心功能节点——`move_group`**。
   - **功能**：`move_group` 节点是 MoveIt 的大脑。它提供了：
     - **运动规划**：通过规划器（如 OMPL）计算机器人从 A 点到 B 点的轨迹。
     - **逆运动学求解**：将末端执行器的位姿转换为关节角度。
     - **碰撞检测**：检查规划出的轨迹是否与环境或自身发生碰撞。
     - **与机器人交互的接口**：提供 Action 和 Service 等接口，供你的程序或其他节点（如 RViz）调用，来指挥机器人运动。
   - **使用场景**：当你已经有一个机器人（仿真或实体）在运行，只需要启动 MoveIt 的规划和控制核心时使用。
3. **`moveit_rviz.launch.py`**
   - **作用**：**启动 RViz 并自动加载为该机器人配置好的 MoveIt 可视化界面**。
   - **功能**：启动 RViz 可视化工具，并加载一个预先配置好的 `.rviz` 配置文件。这个配置文件已经设置了：
     - 机器人的模型显示
     - MoveIt 的交互式标记（Interactive Markers），让你可以用鼠标拖拽来规划目标点。
     - 规划路径的动画显示
     - 碰撞物体的显示等。
   - **使用场景**：在你已经启动了 `move_group` 节点后，需要图形化界面来调试和规划时单独使用。
4. **`rsp.launch.py`** (Robot State Publisher)
   - **作用**：**启动“机器人状态发布器”节点**。
   - **功能**：这个节点读取机器人的 URDF 模型，并根据接收到的关节状态信息（`/joint_states`），持续计算并发布每个连杆的坐标系关系（TF 树）。**这是所有机器人可视化、规划和控制的基础**。
   - **使用场景**：在仿真中（与 Gazebo 配合）或连接实体机器人时，都需要运行这个节点来发布机器人的当前状态。在 `demo.launch.py` 中它被自动包含。

------

### 仿真与硬件控制相关

1. **`spawn_controllers.launch.py`**
   - **作用**：**为仿真环境（如 Gazebo）加载并启动 ROS 控制器**。
   - **功能**：这个文件会调用 `ros2_control` 相关的工具，向控制器管理器（`controller_manager`）加载并启动你在配置 MoveIt Setup Assistant 时设定的控制器，例如：
     - `joint_state_broadcaster`：发布关节状态。
     - `arm_controller`：接收轨迹命令并控制仿真中的关节运动。
     - `gripper_controller`（如果有）：控制夹爪。
   - **使用场景**：**专用于仿真**。当你用 Gazebo 等仿真器启动了一个机器人模型后，再用这个文件来启动控制器，这样 MoveIt 才能通过话题向其发送轨迹指令来控制仿真机器人运动。

------

### 配置与工具

1. **`setup_assistant.launch.py`**
   - **作用**：**重新启动 MoveIt Setup Assistant**。
   - **功能**：方便你再次对当前机器人配置进行修改，例如更改规划组、添加末端执行器、设置关节限位、作者定义碰撞物体等。
   - **使用场景**：当你需要修改机器人的 MoveIt 配置时使用。

------

### 高级/特定功能

1. **`static_virtual_joint_tfs.launch.py`**
   - **作用**：发布**静态虚拟关节的坐标变换（TF）**。
   - **功能**：虚拟关节（Virtual Joint）用于将机器人的根连杆（base_link）连接到世界坐标系（world）。这个文件就是发布这个固定的、静态的坐标变换关系。**这是构建完整 TF 树的关键一环**。
   - **使用场景**：通常被其他 launch 文件（如 `rsp.launch.py`）包含，很少单独手动启动。
2. **`warehouse_db.launch.py`**
   - **作用**：启动 **MoveIt 的规划场景数据库（Warehouse）** 功能。
   - **功能**：提供了一个数据库（默认使用 MongoDB）来存储和读取预先设定的场景信息，例如环境中的障碍物、摆放的物体等。允许你保存（“记住”）和加载不同的工作环境。
   - **使用场景**：在需要持久化保存复杂工作场景的高级应用中使用，普通演示和基础开发中很少用到。



接下来你就要用到hello_moveit的点规划了，这里我建议你加一个tf显示

![image-20251018105649444](/home/lzy/.config/Typora/typora-user-images/image-20251018105649444.png)

这样你可以看到机械臂的末端位姿，然后修改hello_moveit_2里面的点去执行（如果失败建议加长规划时间和次数）